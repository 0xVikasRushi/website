<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A recurring question that I get very often is: “how do I organize my AsyncAPI documents?”. Also, the related one: “I have two services, a publisher and a consumer, should I define both in the same AsyncAPI document?”.
Let’s break down some best practices and tips to avoid ending up in a hell of unmanageable documents.
Organizing Microservices  I’m using the term microservices here because it’s the most common type of distributed architecture that you can find nowadays." />



    



<meta itemprop="name" content="Organizing your AsyncAPI documents | AsyncAPI Initiative">
<meta itemprop="description" content="A recurring question that I get very often is: “how do I organize my AsyncAPI documents?”. Also, the related one: “I have two services, a publisher and a consumer, should I define both in the same AsyncAPI document?”.
Let’s break down some best practices and tips to avoid ending up in a hell of unmanageable documents.
Organizing Microservices  I’m using the term microservices here because it’s the most common type of distributed architecture that you can find nowadays.">
<meta itemprop="image" content="https://www.asyncapi.com/images/posts/organizing-asyncapi-documents.jpg">


<meta name="twitter:card" value="summary_large_image">
<meta name="twitter:title" content="Organizing your AsyncAPI documents | AsyncAPI Initiative">
<meta name="twitter:description" content="A recurring question that I get very often is: “how do I organize my AsyncAPI documents?”. Also, the related one: “I have two services, a publisher and a consumer, should I define both in the same AsyncAPI document?”.
Let’s break down some best practices and tips to avoid ending up in a hell of unmanageable documents.
Organizing Microservices  I’m using the term microservices here because it’s the most common type of distributed architecture that you can find nowadays.">
<meta name="twitter:image" content="https://www.asyncapi.com/images/posts/organizing-asyncapi-documents.jpg">


<meta property="og:title" content="Organizing your AsyncAPI documents | AsyncAPI Initiative" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.asyncapi.com/blog/organizing-asyncapi-documents/" />
<meta property="og:image" content="https://www.asyncapi.com/images/posts/organizing-asyncapi-documents.jpg" />
<meta property="og:description" content="A recurring question that I get very often is: “how do I organize my AsyncAPI documents?”. Also, the related one: “I have two services, a publisher and a consumer, should I define both in the same AsyncAPI document?”.
Let’s break down some best practices and tips to avoid ending up in a hell of unmanageable documents.
Organizing Microservices  I’m using the term microservices here because it’s the most common type of distributed architecture that you can find nowadays." />
    <title>Organizing your AsyncAPI documents | AsyncAPI Initiative</title>
    
<link rel="icon" type="image/png" href="https://www.asyncapi.com/images/favicon.png" />
<link href="https://fonts.googleapis.com/css?family=Open&#43;Sans:400,600" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/style.min.c3608eb94b7beafe1770b53573458965eb0fa30c317a114b20857abb63917b4c.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-highlight/prism-line-highlight.min.css">
<link rel="stylesheet" href="/syntax.css">
</head>

<body>
    

<nav class="navbar is-fresh is-transparent no-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src="/images/logos/asyncapi.png" alt="AsyncAPI logo">
      </a>
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar-menu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

      <div id="navbar-menu" class="navbar-menu is-static">

        <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Learn
            </a>

            <div class="navbar-dropdown">
              <a href="/docs/getting-started" class="navbar-item" >
                Get started
              </a>
              <a href="/docs/tutorials" class="navbar-item" >
                Tutorials
              </a>
              <a href="/docs/specifications/latest" class="navbar-item" >
                Specification
              </a>
            </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Tooling
            </a>

            <div class="navbar-dropdown">
              <a href="http://editor.asyncapi.org" class="navbar-item" target="_blank">
                Online editor
              </a>
              <a href="/docs/tooling#codegens" class="navbar-item" >
                Code generators
              </a>
              <a href="/docs/tooling#docgens" class="navbar-item" >
                Documentation generators
              </a>
              <a href="/docs/tooling#validators" class="navbar-item" >
                Validators
              </a>
              <a href="/docs/tooling#code-first" class="navbar-item" >
                Code-first tools
              </a>
            </div>
          </div>
          <a href="/blog" class="navbar-item is-secondary">
            Blog
          </a>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Help
            </a>

            <div class="navbar-dropdown">
              <a href="https://github.com/asyncapi/asyncapi" class="navbar-item" target="_blank">
                Github repo
              </a>
              <a href="https://join.slack.com/t/asyncapi/shared_invite/enQtNDY3MzI0NjU5OTQyLWU4ZGU2MTg1MDIyZDFjMTI2YjkxYTdlMzc1NjgzYTAxZDM1YTg1NDhhMTE2NDliMjlhZjYxNzk0ZTE5ZGU1ZTg" class="navbar-item" target="_blank">
                Slack workspace
              </a>
            </div>
          </div>
          <a href="/about" class="navbar-item is-secondary">
            About
          </a>
          <a href="/docs/getting-started" class="navbar-item">
            <span class="button signup-button rounded secondary-btn raised">
              Get Started
            </span>
          </a>
        </div>
      </div>
  </div>
</nav>

    
    
<div style="padding:0 2rem;margin-top:30px;">
    <div class="blog-wrapper is-centered-tablet-portrait">
        <h1 class="blog-title">Organizing your AsyncAPI documents</h1>
<div class="blog-meta">
    Mar 1, 2019 •
    
    <span class="blog-meta__tag">AsyncAPI</span>
    
    <span class="blog-meta__tag">Organization</span>
    
    <span class="blog-meta__tag">Documents</span>
    
</div>
<div class="blog-authors">
    
    <div class="blog-author">
        
        <a href="https://twitter.com/fmvilas" target="_blank" class="blog-author__photo--link">
        
            <img src="/images/avatars/fmvilas.jpg" class="blog-author__photo"/>
        
        </a>
        
        <div class="blog-author__info">
            <div class="blog-author__info__name">
                
                    <a href="https://twitter.com/fmvilas" target="_blank" class="blog-author__info__name--link">Fran Méndez</a>
                
            </div>
            <div class="blog-author__info__date">
            AsyncAPI founder
            </div>
        </div>
    </div>
    
</div>
<div class="blog-content">

<p>A recurring question that I get very often is: “how do I organize my AsyncAPI documents?”. Also, the related one: “I have two services, a publisher and a consumer, should I define both in the same AsyncAPI document?”.</p>

<p>Let’s break down some best practices and tips to avoid ending up in a hell of unmanageable documents.</p>

<h2 id="organizing-microservices">Organizing Microservices<a href="#organizing-microservices" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h2>

<blockquote>
<p>I’m using the term microservices here because it’s the most common type of distributed architecture that you can find nowadays.</p>
</blockquote>

<p>The best practice for organizing AsyncAPI files in your microservices architecture is to have a file per microservice. This way, you end up with multiple independent files that define your application.</p>

<figure>
    <img src="/images/posts/organizing-asyncapi-documents-1.png"/> <figcaption>
            <h4>One publisher and one subscriber, both sharing the UserSignUp message.</h4>
        </figcaption>
</figure>


<p>Microservices are meant to do a single thing and to do it well and, very importantly, they must be independently deployable. However, if you have a publisher and multiple consumers, you quickly end up having something like the following:</p>

<figure>
    <img src="/images/posts/organizing-asyncapi-documents-2.png"/> <figcaption>
            <h4>One publisher and various subscribers. All of them sharing the UserSignUp message.</h4>
        </figcaption>
</figure>


<p>It’s clear there’s a dependency between all of them: the <em>UserSignedUp</em> message. If at some point to want to change it, you’ll have to go through all of the files and change it. It’s a tedious task we want to avoid, so we can make use of the <em>$ref</em> capability of AsyncAPI to simplify things:</p>

<figure>
    <img src="/images/posts/organizing-asyncapi-documents-3.png"/> <figcaption>
            <h4>The value of $ref should be “common/messages.json#UserSignedUp”.</h4>
        </figcaption>
</figure>


<p>Now, if you have to add something to the <em>UserSignedUp</em> message, it’s just a matter of changing one file. Depending on your setup, you may have to restart your services to get the new definition. However, as simple and straightforward as it may seem, you must take care not to introduce breaking changes in the message definition. Otherwise, you’ll have inconsistent states while some services got the new message definition and some didn’t yet. Here comes the importance of versioning your messages, but that makes for another blog post alone.</p>

<h3 id="common-mistakes">Common mistakes<a href="#common-mistakes" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h3>

<p>Since microservices tend to be small in scope, most probably their AsyncAPI document will not be very extensive too. And I found out this is one of the reasons people tend to re-use the same file for many services. They think the file is very small and because the publisher and the subscriber share the same message, why not putting everything there? It’s tempting at first, but the reason why you should avoid doing this is that you lose context and semantics, and it causes problems:</p>

<ol>
<li>If a single document contains publish and subscribe for the same channel (topic), how do you know which one is defining what your application does?</li>
<li>Since your document may contain many channels, how do you know if your application is publishing or subscribing to each channel or just a subset of them? That itself causes more problems, for instance, when you want to generate the documentation for a single service but you have a single file defining your whole architecture and thus a single documentation page describing all the services without any clue which one is doing what.</li>
</ol>

<p><strong>An AsyncAPI file is meant to define the behavior of a single application</strong>. You can obviously break the rules and use it to define the whole architecture but expect all sorts of problems to appear because you’re using a hammer to saw a piece of wood. The same way you don’t use a single OpenAPI (Swagger) file to define many of your REST APIs, you shouldn’t use a single AsyncAPI document to define many of your message-driven APIs.</p>

<h2 id="organizing-client-server">Organizing Client-Server<a href="#organizing-client-server" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h2>

<p>Say, for instance, you have a WebSockets API and front-end application using it. The paradigm is very similar to the one we’re used to with HTTP APIs, with the subtle difference that the communication is <a href="https://en.wikipedia.org/wiki/Duplex_%28telecommunications%29#Full_duplex" target="_blank">full duplex</a>, i.e., the client can send and receive messages over the same channel, at any time.</p>

<p>This case is not very different from the microservices one. If you think about it, we can look at it as a small distributed architecture, where you only have two services: the client and the server. So the recommended best practice is to follow the same approach and have one document for each of the applications — one for the server and another for the client or front-end.</p>

<h2 id="summary">Summary<a href="#summary" class="hanchor" ariaLabel="Anchor"> #&#xFE0E;</a> </h2>

<p>I want to reinforce the point that an AsyncAPI file is meant to define <strong>the behavior of a single application</strong>. Keep this always in mind, and everything will make sense to you.</p>

<p>Happy coding! ✌️</p>

<hr />

<p>AsyncAPI is an open source project running on donations so <strong>please <a href="https://opencollective.com/asyncapi" target="_blank">consider donating</a></strong>. 🙌</p>
</div>
    </div>
</div>


<footer class="footer footer-dark">
  <div class="container">
    <div class="columns">
      <div class="column">
        <div class="footer-logo">
          <img src="/images/logos/logo-footer.png">
        </div>
      </div>
      <div class="column">
        <div class="footer-column">
          <div class="footer-header">
            <h3>Follow Us</h3>
            <nav class="level is-mobile">
              <div class="level-left">
                <a class="level-item" href="https://github.com/asyncapi/asyncapi" target="_blank">
                  <span class="icon"><i class="fab fa-github"></i></span>
                </a>
                <a class="level-item" href="https://join.slack.com/t/asyncapi/shared_invite/enQtNDY3MzI0NjU5OTQyLWU4ZGU2MTg1MDIyZDFjMTI2YjkxYTdlMzc1NjgzYTAxZDM1YTg1NDhhMTE2NDliMjlhZjYxNzk0ZTE5ZGU1ZTg" target="_blank">
                  <span class="icon"><i class="fab fa-slack"></i></span>
                </a>
                <a class="level-item" href="https://medium.com/asyncapi" target="_blank">
                  <span class="icon"><i class="fab fa-medium"></i></span>
                </a>
                <a class="level-item" href="https://www.youtube.com/channel/UCIz9zGwDLbrYQcDKVXdOstQ" target="_blank">
                  <span class="icon"><i class="fab fa-youtube"></i></span>
                </a>
                <a class="level-item" href="https://twitter.com/search?q=asyncapi" target="_blank">
                  <span class="icon"><i class="fab fa-twitter"></i></span>
                </a>
              </div>
            </nav>

            <h6>Icons & Graphics attributions</h6>
            <div class="attributions">
              <a href="https://www.freepik.com/free-photos-vectors/background">Background vector created by starline -
                www.freepik.com</a>
              <div>Icons made by <a href="https://www.flaticon.com/authors/good-ware" title="Good Ware">Good Ware</a>, <a href="https://www.freepik.com/" title="Freepik">Freepik</a>, <a href="https://www.flaticon.com/authors/pixel-perfect" title="Pixel perfect">Pixel perfect</a>, and <a href="https://www.flaticon.com/authors/icongeek26" title="Icongeek26">Icongeek26</a> from <a href="https://www.flaticon.com/"
                  title="Flaticon">www.flaticon.com</a> are licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0"
                  target="_blank">CC 3.0 BY</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cb852c7b57ed596"></script>


    <script>
    (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-109278936-1', 'https:\/\/www.asyncapi.com\/');
    ga('send', 'pageview');
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://www.asyncapi.com/js/fresh.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-yaml.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.js"></script>
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-highlight/prism-line-highlight.min.js"></script>

<script>
    $('pre code').addClass('line-numbers');
</script>


<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function (regs) {
      if (regs && regs.length > 0) {
        for (var registration of regs) {
          registration.unregister();
        }
      }
    });
  }
</script>
</body>

</html>